import tkinter as tk
from tkinter import ttk
from tkinter import messagebox
import locale

# تلاش برای تنظیم محلی (Locale) به زبان فارسی
try:
    locale.setlocale(locale.LC_ALL, "fa_IR.UTF-8")
except locale.Error:
    try:
        locale.setlocale(locale.LC_ALL, "fa_IR")
    except locale.Error:
        print("هشدار: امکان تنظیم محلی به زبان فارسی وجود ندارد. نمایش اعداد ممکن است صحیح نباشد.")
        pass

class TourismSupportSystem:
    def __init__(self):
        self.flights = {}
        self.hotels = {}
        self.taxis = {}
        self.bookings = []
        self.window = tk.Tk()
        self.window.title("سامانه پشتیبانی گردشگری")
        self.window.geometry("800x600")

        self.create_widgets()
        self.add_sample_data()

    # افزودن داده‌های نمونه برای نمایش اولیه
    def add_sample_data(self):
        self.add_flight("تهران", "مشهد", "2024-03-25", 150)
        self.add_flight("تهران", "مشهد", "2024-03-26", 140)
        self.add_flight("تهران", "شیراز", "2024-03-25", 120)
        self.add_flight("مشهد", "تهران", "2024-03-30", 160)

        self.add_hotel("مشهد", "هتل 1", 50)
        self.add_hotel("مشهد", "هتل 2", 70)
        self.add_hotel("شیراز", "هتل A", 60)
        self.add_hotel("تهران", "هتل پارس", 90)

        self.add_taxi("مشهد", 1.5)
        self.add_taxi("شیراز", 1.2)
        self.add_taxi("تهران", 2.0)

    # ایجاد عناصر گرافیکی برنامه
    def create_widgets(self):
        # قاب اصلی منو
        self.menu_frame = tk.Frame(self.window)
        self.menu_frame.pack(pady=20)

        # دکمه‌ها
        ttk.Button(
            self.menu_frame,
            text="نمایش برنامه سفر",
            command=self.show_travel_plan_window,
            width=20
        ).grid(row=0, column=0, padx=10, pady=10)
        ttk.Button(
            self.menu_frame,
            text="رزرو بلیط هواپیما",
            command=self.show_book_flight_window,
            width=20
        ).grid(row=1, column=0, padx=10, pady=10)
        ttk.Button(
            self.menu_frame,
            text="رزرو هتل",
            command=self.show_book_hotel_window,
            width=20
        ).grid(row=2, column=0, padx=10, pady=10)
        ttk.Button(
            self.menu_frame,
            text="رزرو تاکسی",
            command=self.show_book_taxi_window,
            width=20
        ).grid(row=3, column=0, padx=10, pady=10)
        ttk.Button(
            self.menu_frame,
            text="مشاهده رزروها",
            command=self.view_bookings,
            width=20
        ).grid(row=4, column=0, padx=10, pady=10)
        ttk.Button(
            self.menu_frame, text="خروج", command=self.window.quit, width=20
        ).grid(row=5, column=0, padx=10, pady=10)

    # افزودن اطلاعات پرواز
    def add_flight(self, origin, destination, date, price):
        if origin not in self.flights:
            self.flights[origin] = {}
        if destination not in self.flights[origin]:
            self.flights[origin][destination] = []
        self.flights[origin][destination].append((date, price))

    # افزودن اطلاعات هتل
    def add_hotel(self, city, name, price_per_night):
        if city not in self.hotels:
            self.hotels[city] = []
        self.hotels[city].append((name, price_per_night))

    # افزودن اطلاعات تاکسی
    def add_taxi(self, city, price_per_km):
        self.taxis[city] = price_per_km

    # جستجوی پرواز بر اساس مبدا و مقصد
    def search_flights(self, origin, destination):
        if origin in self.flights and destination in self.flights[origin]:
            return self.flights[origin][destination]
        else:
            return None

    # جستجوی هتل بر اساس شهر
    def search_hotels(self, city):
        if city in self.hotels:
            return self.hotels[city]
        else:
            return None

    # رزرو پرواز
    def book_flight(self, origin, destination, date, price):
        self.bookings.append(
            {
                "type": "flight",
                "origin": origin,
                "destination": destination,
                "date": date,
                "price": price,
            }
        )
        messagebox.showinfo(
            "موفقیت",
            f"پرواز از {origin} به {destination} در تاریخ {date} با موفقیت رزرو شد!",
        )

    # رزرو هتل
    def book_hotel(self, city, hotel_name, price_per_night, num_nights):
        self.bookings.append(
            {
                "type": "hotel",
                "city": city,
                "hotel": hotel_name,
                "price_per_night": price_per_night,
                "num_nights": num_nights,
            }
        )
        messagebox.showinfo(
            "موفقیت",
            f"هتل {hotel_name} در {city} به مدت {num_nights} شب با موفقیت رزرو شد!",
        )

    # رزرو تاکسی
    def book_taxi(self, city, distance):
        if city in self.taxis:
            price = self.taxis[city] * distance
            self.bookings.append(
                {
                    "type": "taxi",
                    "city": city,
                    "distance": distance,
                    "price": price,
                }
            )
            messagebox.showinfo(
                "موفقیت",
                f"تاکسی در {city} به مسافت {distance} کیلومتر رزرو شد. هزینه کل: {price}",
            )
        else:
            messagebox.showerror("خطا", "سرویس تاکسی در این شهر موجود نیست.")

    # مشاهده رزروها
    def view_bookings(self):
        if not self.bookings:
            messagebox.showinfo("رزروها", "هیچ رزروی تاکنون انجام نشده است.")
        else:
            bookings_window = tk.Toplevel(self.window)
            bookings_window.title("مشاهده رزروها")

            bookings_text = ""
            for booking in self.bookings:
                bookings_text += str(booking) + "\n"

            tk.Label(bookings_window, text=bookings_text, justify="right").pack(
                padx=20, pady=20
            )

    # فرمت اعداد به صورت فارسی
    def format_persian_number(self, num):
        try:
            return locale.format_string("%d", num, grouping=True)
        except:
            return str(num)

    # سایر توابع برای پنجره‌های مختلف... (مانند نمایش برنامه سفر، رزرو پرواز، هتل و تاکسی)

    def run(self):
        self.window.mainloop()

if __name__ == "__main__":
    system = TourismSupportSystem()
    system.run()